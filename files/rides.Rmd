---
title: "rides"
author: Matthew Parin
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, eval=FALSE}
install.packages("data.table")
```

Load the package functions into your environment:

```{r, eval=TRUE}
library(data.table)
```

Let's go ahead and load the data for the rides from Divvy in 2016 using the
"fread" funtion from the `data.table` package, making sure its a data.frame:

```{r, eval=FALSE}
rides <- as.data.frame(fread("../data/Divvy_Trips_2016.csv",sep = ",",header = TRUE,
               stringsAsFactors = FALSE))
```

Address holes in the data.

```{r, eval=FALSE}
i               <- which(rides$gender == "")
rides$gender[i] <- NA
e               <- which(rides$birthyear == "")
rides$birthyear[e] <- NA
```

## Create some factor columns

You may know a "factor" as a "categorical variable". In R, the
categories are called "levels". A couple good candidates for factors
are the gender and usertype columns:

```{r, eval=FALSE}
rides <- transform(rides, usertype = factor(usertype))
rides <- transform(rides, gender = factor(gender))
class(rides$gender)
class(rides$usertype)
summary(rides$gender)
summary(rides$usertype)
```

Convert the station names to factors, too.

We will also see soon that it is useful to convert the "station name"
columns to factors.

```{r, eval=FALSE}
rides <- transform(rides,
                   from_station_name = factor(from_station_name,
				                              rownames(stations)),
                   to_station_name   = factor(to_station_name,
				                              rownames(stations)))
```

Factoring the station names allows us to quickly generate more informative summaries of
the rides by station:

```{r, eval=FALSE}
summary(rides$from_station_name)
```

## Manage the date and time of the rides

To convert the dates and times, install and load the
[lubridate package](http://lubridate.tidyverse.org).

```{r, eval=FALSE}
# install.packages("lubridate")
library(lubridate)
```

Create a function for parse the dates and times to
accommodate the inconsistent format of the date & time data stored in
the Divvy CSV files.

```{r, eval=TRUE}
parse.dt <- function (x) {
  out    <- suppressWarnings(mdy_hms(x))
  i      <- is.na(out)
  out[i] <- mdy_hm(x[i])
  return(out)
}
```

This code chunk parses the dates & times, then creates new tables columns for start.week, start.day, and start.month

```{r, eval=FALSE}
rides <- transform(rides, starttime = parse.dt(starttime))
rides <- transform(rides, start.week = as.numeric(format(starttime,"%W")))
rides <- transform(rides,
           start.day = factor(weekdays(as.Date(starttime)),
                              c("Monday","Tuesday","Wednesday","Thursday",
                                "Friday","Saturday","Sunday")))
rides <- transform(rides,
           start.month = factor(months(as.Date(starttime)),
                              c("January","February","March","April",
                                "May", "June", "July", "August",
                                "September","October","November",
                                "December")))
```

## Trips from Top Location

After having prepared the data more carefully, let's take a look at the data from the top station.

```{r, eval=FALSE}
navy_pier.rides <- subset(rides, from_station_name == navy_pier)
summary(navy_pier.rides)
summary(navy_pier.rides$start.week)
summary(navy_pier.rides$to_station_name)
```

It is interesting to compare the top trends compared the rest of the city:

```{r, eval=FALSE}
rbind(summary(rides$start.day),
      summary(navy_pier.rides$start.day))
```

It is also fun to look in more detail at the final destinations of all
people who started riding from top stations:

```{r, eval=FALSE}
navy_pier.top.dests <- summary(navy_pier.rides$to_station_name)
i        <- which(navy_pier.top.dests > 0)
navy_pier.top.dests <- navy_pier.top.dests[i]
navy_pier.top.dests
data.frame(navy_pier.top.dests)
```


```{r, eval=FALSE}
save.image(file = "divvy.RData")
```


